#!/bin/bash

set +u
while [ "$1" != "" ]
do
   case $1 in
      "[0-9]*\.[0-9]*") VERSION=$1 ;;
      "-v") shift; VERSION=$1 ;;
      "-f") shift; LSFILE=$1 ;;
      *)    SEARCH_STRING=$1 ;;
   esac
   shift
done

if [ "$LSFILE" = "" ]
then
   if [ "$VERSION" = "" ]
   then
      LSFILE=/usr/archive/ls-lR.*.gz
   else
      LSFILE=/usr/archive/ls-lR.$VERSION.SuSE.gz
   fi
fi

gzip -dc $LSFILE | \
awk \
"BEGIN {dir=\"\";printed=0}
 /^CD/{dir = \$1; printed=0}
 /$SEARCH_STRING/{if(!printed){print dir; printed=1} print \$0}"
