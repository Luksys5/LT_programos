#!/bin/sh

TMP_DIR="${tmp}"

if [ $# -ne 1 ]; then
    echo "$0: *** ERROR: ***" >&2
    echo "Please supply an Acta Crystallographica coeditor code" >&2
    echo "on the command line." >&2
    echo "Usage:" >&2
    echo "    `basename $0` bs1011 " >&2
    exit 1
fi

set -ue
set +x

# ${1+"$@"}

PAPER_CODE="$1"

##cat ${PAPER_CODE}.endnote \

wget \
--user-agent="" \
--post-data="saveas=EndNote&image=download_bibliographic_record&Action=download&cnor=${PAPER_CODE}" \
http://scripts.iucr.org/cgi-bin/biblio \
-O - \
| perl -ne '
if( !/^%A / && int(@authors)) {
    $authors[-1] =~ s/;\s*$//;
    print "<authors separator=\";\">", @authors, "</authors>\n";
    @authors = ();
}
if(s/^%A //) {s/,\s*$/; /; s/^\s*//g; push(@authors, $_)}
if(s/^%T //) {
    s/\s*$//g;
    print "<title>", $_, "</title>\n";
}
if(s/^%B //) {
    s/\s*$//g;
    print "<journal>", $_, "</journal>\n";
}
if(s/^%D //) {
    s/\s*$//g;
    print "<year>", $_, "</year>\n";
}
if(s/^%V //) {
    s/\s*$//g;
    print "<volume>", $_, "</volume>\n";
}
if(s/^%N //) {
    s/\s*$//g;
    print "<issue>", $_, "</issue>\n";
}
if(s/^%P //) {
    s/\s*$//g;
    print "<pages>", $_, "</pages>\n";
}
if(s/^%R //) {
    s/\s*$//g;
    print "<doi>", $_, "</doi>\n";
}
if(s/^%U //) {
    s/\s*$//g;
    print "<url>", $_, "</url>\n";
}
' \
| awk '{print}'
