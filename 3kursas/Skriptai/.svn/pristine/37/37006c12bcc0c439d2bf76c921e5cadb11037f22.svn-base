#!/bin/sh
#------------------------------------------------------------------------------
#$Author$
#$Date$
#$Revision$
#$URL$
#------------------------------------------------------------------------------

set -ue

Id='$Id$'

CDDEV=/dev/scd0

BURN=true
IMAGE=""

cdrecorder=wodim
## cdrecorder=cdrecord

#**OPTIONS:
#**  -d, --device /dev/scd0
#**          Specify device to burn image
#**
#**  -c, --check-noly, --no-burn
#**          Do not burn disc, conly ckeck it
#**
#**  -b, --burn
#**          Burn disc from image, override any previous --check-only options
#**          (default)
#**
#**  --help  print short help message (this message) and exit

while [ $# -gt 0 ]
do
    case $1 in
	-d|--device|--devic|--devi|--dev|--de|--d)
	    CDDEV="$2"
	    shift
	    ;;
	-c|--check-only|--check-onl|--check-on|--check-o\
          |--check|--chec|--che|--ch|--c\
          |--no-burn|--no-bur|--no-bu|--no-b)
	    BURN=false
	    ;;
	-b|--burn|--bur|--bu|--b)
	    BURN=true
	    ;;
	--help|--hel|--he|--h)
	    echo $Id
	    echo
	    echo "Usage:"
	    echo "    $(basename $0) [options] cdimage.iso"
	    echo ""
            awk '/#\*/,/#\*\*/{sub("^ *#[*]?[*]?", ""); print $0}' $0
	    exit
	    ;;
	-*) echo "$0: unkonwn option '$1'"; exit 1 ;;
	*)  IMAGE="$1" ;;
    esac
    shift
done

if [ $BURN = true ]
then
    if [ -n ${IMAGE} ]
    then
	( set -x; sudo ${cdrecorder} -v -dao dev=$CDDEV -data $IMAGE )
    else
	echo "$0: please specify image (.iso, ISO9660 filesystem) file to burn"\
             "on the command line" >&2
	exit 2
    fi
fi

set -x

sudo mount $CDDEV /cdrom
( cd /cdrom; md5sum -c md5sum.txt )
sudo umount /cdrom

sudo cdck -d $CDDEV
