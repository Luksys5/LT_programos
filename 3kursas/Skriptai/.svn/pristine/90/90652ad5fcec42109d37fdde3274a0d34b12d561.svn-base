#!/usr/bin/perl -w
#------------------------------------------------------------------------
#$Author:$
#$Date:$ 
#$Header:
#$Locker:$
#$Log:$
#$Revision:$
#$Source:$
#$State:$
#------------------------------------------------------------------------

use strict;
use File::Basename;

my @header = (
   1200,
   1200,
   2400,
   1200,
   0,
   0,
   0,
   0,
   0,
   0,
   0.0,
   61.5,
   0.0,
   0,
   0,
   0,
   0,
   61.5,
   61.5,
   1.54178,
   100.0,
   0.0,
   0.0,
   0.0,
   1.0,
   "",
   "scan2image v1.0",
   "001",
   "DUNIX/ALPHA",
   "",
);

my $file;
for $file (@ARGV) {

    my $image_file = basename($file, ".fi1") . ".image";

    print STDERR "$file --> $image_file\n";

    open(SCAN, $file) or die("Can't open '$file': $!");
    open(IMAGE, ">$image_file") or die("Can't open '$image_file' for writing: $!");

    my $bin_header = pack("I10f15" . "A16"x5 , @header);
    $bin_header = $bin_header . "\0" x (2400 - length($bin_header));
    print IMAGE $bin_header;

    seek(SCAN, 2200, 0);
    my $raster = "";
    for(1..1120) {
        read(SCAN, $raster, 1100);
        $raster = pack( "S1100x200",  unpack( "C1100", $raster) );
        print IMAGE $raster;
    }

    for(1..80) {
        print IMAGE "\0\0" x 1200;
    }

    close(IMAGE);
    close(SCAN);
}
