#!/bin/sh

set -ue
##set -x

if [ $# -ne 1 ]
then
    echo "Please specfy the name of the computer to fetch your home setupt from"
    echo "Usage:"
    echo "    `basename $0` home.ibt.lt"
    exit 1
fi

SOURCE_HOST="$1"

cd ~

BACKUP_SUFFIX="-DIST"
TEST_BACKUP=".bashrc${BACKUP_SUFFIX}"

if [ ! -f ${TEST_BACKUP} ]
then
    set +e
    rsync -av \
	${SOURCE_HOST}:.'{bashrc,emacs,profile,logout,bash_profile,alias,Xdefaults,nanorc}' \
	. \
	--backup \
	--suffix ${BACKUP_SUFFIX} \
	${RSYNC_OPTIONS:-}
    set -e
else
    echo "`basename $0`: ${TEST_BACKUP} file exists -- not syncing the setup files."
fi

TEST_BACKUP=".subversion/config${BACKUP_SUFFIX}"

if [ ! -f ${TEST_BACKUP} ]
then
    set +e
    rsync -av \
	${SOURCE_HOST}:.subversion/config \
	.subversion/ \
	--backup \
	--suffix ${BACKUP_SUFFIX} \
	${RSYNC_OPTIONS:-}
    set -e
else
    echo "`basename $0`: ${TEST_BACKUP} file exists -- not syncing the setup files."
fi

for dir in scripts .prepare lib
do
  if [ ! -d ${dir} ]
  then
      rsync -av ${SOURCE_HOST}:${dir} . ${RSYNC_OPTIONS:-}
  else
    echo "`basename $0`: ${dir} directory exists -- not syncing it."     
  fi
done

for dir in .ssh
do
  rsync -av ${SOURCE_HOST}:${dir} . --ignore-existing ${RSYNC_OPTIONS:-}
done
